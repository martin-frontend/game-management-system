(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-35502f5a"],{"004e":function(t,e,a){"use strict";a("131d")},"131d":function(t,e,a){},"4ff4":function(t,e,a){"use strict";a("5cdd")},"5cdd":function(t,e,a){},"5e9b":function(t,e,a){"use strict";a("8f2f")},"6c2c":function(t,e,a){"use strict";a("7c56")},"7c56":function(t,e,a){},"8f2f":function(t,e,a){},c3f1:function(t,e,a){},e350:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));a("caad"),a("45fc"),a("ac1f"),a("2532"),a("1276");var n=a("4360");function o(t){if(t&&t instanceof Array&&t.length>0){var e=n["a"].getters&&n["a"].getters.roles,a=e.split(","),o=t,i=a.some((function(t){return o.includes(t)}));return i}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}},ea3c:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-container"},[a("div",{staticClass:"table-container"},[a("el-tag",[t._v("帳號停權")]),t.checkPermission(["修改帳號停權"])?a("el-button",{staticStyle:{float:"right"},attrs:{icon:"el-icon-plus",type:"primary",circle:""},on:{click:t.add}}):t._e(),a("el-tabs",{staticStyle:{"margin-top":"10px"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.tabMapOptions,(function(e){return a("el-tab-pane",{key:e.key,attrs:{label:e.label,name:e.key}},[["banList"===t.activeName?a("List",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"table-data":t.filterData(t.tableData)},on:{initdata:t.initdata}}):t._e(),"history"===t.activeName?a("HistoryList",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"table-data":t.tableData},on:{initdata:t.initdata}}):t._e()]],2)})),1)],1),a("Dialog",{ref:"dialog",on:{initdata:t.initdata}})],1)},o=[],i=(a("4de4"),a("2909")),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{attrs:{data:t.tableData,border:""}},[t.checkPermission(["修改帳號停權"])?a("el-table-column",{attrs:{prop:"operating",label:"功能",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.recovery(e.row)}}},[t._v("復權")])]}}],null,!1,4164920108)}):t._e(),a("el-table-column",{attrs:{prop:"account",label:"帳號",width:"180"}}),a("el-table-column",{attrs:{label:"復權時間"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.TransformTime(e.row.releaseState,e.row.releaseDate))+" ")]}}])}),a("el-table-column",{attrs:{prop:"reason",label:"原因"}})],1),a("div",{staticClass:"table-pagination"},[a("el-pagination",{attrs:{"current-page":1,"page-sizes":[100,200,300,400],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:t.tableData.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},s=[],c=a("e350"),l=a("b775");function u(){return Object(l["a"])({url:"operation/getban",method:"get"})}function d(t){return Object(l["a"])({url:"operation/createban",method:"post",data:t})}function f(t){return Object(l["a"])({url:"operation/updateban",method:"post",data:t})}var m=a("c1df"),h=a.n(m),p={name:"Item",props:{tableData:{type:Array,default:function(){return[]}}},data:function(){return{}},methods:{checkPermission:c["a"],handleSizeChange:function(t){console.log("每页 ".concat(t," 条"))},handleCurrentChange:function(t){console.log("当前页: ".concat(t))},recovery:function(t){var e=this,a=new FormData;a.append("id",t.id),a.append("releaseState","0"),a.append("releaseDate",h()().valueOf()),a.append("reason",""),f(a).then((function(t){var a=t.data;a.success?(e.$emit("initdata"),e.$message.success(a.msg)):e.$message.warning(a.msg)})).catch((function(t){console.log(t)}))},TransformTime:function(t,e){return"1"===t?"永久停權":h()(e).format("YYYY-MM-DD HH:mm:ss")}}},b=p,g=(a("5e9b"),a("2877")),D=Object(g["a"])(b,r,s,!1,null,"65061e07",null),v=D.exports,k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{attrs:{data:t.tableData,border:""}},[a("el-table-column",{attrs:{prop:"isbaned",label:"狀態",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.isbaned?"停權中":"已復權")+" ")]}}])}),a("el-table-column",{attrs:{prop:"account",label:"帳號",width:"180"}}),a("el-table-column",{attrs:{label:"復權時間"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.TransformTime(e.row.releaseState,e.row.releaseDate))+" ")]}}])}),a("el-table-column",{attrs:{prop:"reason",label:"原因"}})],1),a("div",{staticClass:"table-pagination"},[a("el-pagination",{attrs:{"current-page":1,"page-sizes":[100,200,300,400],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:t.tableData.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},y=[],_={name:"Item",props:{tableData:{type:Array,default:function(){return[]}}},data:function(){return{}},methods:{checkPermission:c["a"],handleSizeChange:function(t){console.log("每页 ".concat(t," 条"))},handleCurrentChange:function(t){console.log("当前页: ".concat(t))},recovery:function(t){var e=this,a=new FormData;a.append("id",t.id),a.append("releaseDate",h()().valueOf()),f(a).then((function(t){var a=t.data;a.success?(e.$emit("initdata"),e.$message.success(a.msg)):e.$message.warning(a.msg)})).catch((function(t){console.log(t)}))},TransformTime:function(t,e){return"1"===t?"永久停權":h()(e).format("YYYY-MM-DD HH:mm:ss")}}},w=_,C=(a("6c2c"),Object(g["a"])(w,k,y,!1,null,"3d1ad329",null)),x=C.exports,$=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.dialogFormVisible?a("el-dialog",{attrs:{title:t.title,"before-close":t.handleClose,visible:t.dialogFormVisible,width:"50%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[a("el-form-item",{attrs:{label:"帳號",prop:"account","label-width":t.formLabelWidth}},[a("el-input",{staticClass:"form-width form-margin",model:{value:t.formData.account,callback:function(e){t.$set(t.formData,"account",e)},expression:"formData.account"}}),a("el-button",{on:{click:t.addAccounts}},[t._v("新增多筆帳號")])],1),t.checked?t._e():a("el-form-item",{attrs:{label:"停權天數",prop:"days","label-width":t.formLabelWidth}},[a("el-input",{staticClass:"form-width form-margin",attrs:{disabled:t.formData.checked},model:{value:t.formData.days,callback:function(e){t.$set(t.formData,"days",e)},expression:"formData.days"}})],1),a("el-form-item",{attrs:{label:"結束時間","label-width":t.formLabelWidth,disabled:t.formData.checked}},[t.checked?t._e():a("el-date-picker",{staticClass:"form-margin",attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",disabled:""},model:{value:t.formData.releaseDate,callback:function(e){t.$set(t.formData,"releaseDate",e)},expression:"formData.releaseDate"}}),t.checked?a("el-input",{staticClass:"form-width form-margin",attrs:{value:"永久停權",disabled:""}}):t._e(),a("el-checkbox",{model:{value:t.formData.checked,callback:function(e){t.$set(t.formData,"checked",e)},expression:"formData.checked"}},[t._v("永久停權")])],1),a("el-form-item",{attrs:{label:"事由","label-width":t.formLabelWidth}},[a("el-input",{attrs:{type:"textarea",rows:6,placeholder:"請輸入停權事由"},model:{value:t.formData.reason,callback:function(e){t.$set(t.formData,"reason",e)},expression:"formData.reason"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.createSuspension}},[t._v("建 立")])],1)],1):t._e(),a("AddAcounts",{ref:"addAcounts",attrs:{"form-data":t.formData},on:{setInit:t.setInit}}),a("ConfirmModify",{ref:"confirmModify",on:{initdataChild:t.initdataChild}})],1)},O=[],L=(a("c975"),a("a434"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:t.title,"before-close":t.handleClose,"close-on-click-modal":!1,visible:t.dialogFormVisible,width:"50%"}},[a("el-form",{attrs:{model:t.formData}},t._l(t.formData.accountList,(function(e,n){return a("el-form-item",{key:e.key,attrs:{label:"帳號","label-width":t.formLabelWidth}},[a("el-input",{staticClass:"form-width form-margin",model:{value:e.account,callback:function(a){t.$set(e,"account",a)},expression:"account.account"}}),0==n?a("el-button",{on:{click:t.addAccount}},[t._v("新增帳號")]):a("el-button",{on:{click:function(a){return a.preventDefault(),t.removeAccount(e)}}},[t._v("删除")])],1)})),1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.addAccounts}},[t._v("確 認")])],1)],1)],1)}),F=[],A=(a("a15b"),a("d81d"),a("cd3f")),S={name:"AddAccounts",props:{formData:{type:Object,default:function(){return[]}}},data:function(){return{dialogFormVisible:!1,formLabelWidth:"80px",title:"新增多筆帳號",initData:{},excelData:{header:null,results:null}}},methods:{handleClose:function(t){this.loading=!1,this.dialogFormVisible=!1,this.setInit()},handleOpen:function(t,e){this.dialogFormVisible=!0},generateData:function(t){var e=t.results;this.formData.accountList=e},beforeUpload:function(t,e){console.log(t,e);var a=".csv"===t.type,n="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===t.type,o="application/vnd.ms-excel"===t.type;return a||n||o?a||n||o:(this.$message.error("格式錯誤"),!1)},removeAccount:function(t){var e=this.formData.accountList.indexOf(t);-1!==e&&this.formData.accountList.splice(e,1)},addAccount:function(){this.formData.accountList.push({account:"",key:Date.now()})},addAccounts:function(){var t=this,e=this.formData.accountList.filter((function(e,a){return""!==e.account&&t.formData.accountList.indexOf(e)===a}));if(e.length>0){var a=e.map((function(t){return t.account}));this.formData.account=a.join()}console.log(this.formData.account),this.dialogFormVisible=!1},createInit:function(){var t=A(this.formData);this.initData=t},setInit:function(){var t=A(this.initData);this.$emit("setInit",t)}}},M=S,T=(a("004e"),Object(g["a"])(M,L,F,!1,null,"3d04bc50",null)),j=T.exports,V=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:t.title,"before-close":t.handleClose,"close-on-click-modal":!1,visible:t.dialogFormVisible,width:"50%"}},[a("el-form",{attrs:{model:t.checkDataForm}},[a("el-checkbox-group",{model:{value:t.checkDataForm.check,callback:function(e){t.$set(t.checkDataForm,"check",e)},expression:"checkDataForm.check"}},t._l(t.checkData,(function(e){return a("el-checkbox",{key:e.account,attrs:{label:e.account}},[a("p",{domProps:{innerHTML:t._s(t.checkboxText(e.account,e.releaseDate,e.releaseState))}})])})),1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.OnSubmit}},[t._v("更 新")])],1)],1)],1)},z=[],H=(a("4160"),a("caad"),a("a9e3"),a("2532"),a("159b"),{name:"AddAccounts",data:function(){return{dialogFormVisible:!1,formLabelWidth:"80px",title:"確認更新",initData:{},excelData:{header:null,results:null},oriData:null,checkData:[],checkDataForm:{check:[]}}},methods:{handleClose:function(){this.loading=!1,this.dialogFormVisible=!1},handleOpen:function(t,e){this.checkData=e,this.oriData=t,this.dialogFormVisible=!0},TransformTime:function(t){return h()(t).format("YYYY-MM-DD HH:mm:ss")},checkboxText:function(t,e,a){var n=this.oriData.get("releaseDate");return console.log(a),t+"<br>修改前:"+("1"===a?"永久停權":this.TransformTime(e))+"  修改後:"+this.TransformTime(Number(n))},OnSubmit:function(){var t=this,e=[];this.checkData.forEach((function(a){t.checkDataForm.check.includes(a.account)&&e.push(a._id)}));var a=new FormData;a.append("id",e.join()),a.append("releaseDate",this.oriData.get("releaseDate")),a.append("releaseState",this.oriData.get("releaseState")),a.append("reason",this.oriData.get("reason")),f(a).then((function(e){var a=e.data;a.success?t.$message.success(a.msg):t.$message.warning(a.msg),t.$emit("initdataChild"),t.handleClose()})).catch((function(t){console.log(t)}))}}}),Y=H,I=(a("4ff4"),Object(g["a"])(Y,V,z,!1,null,"0f57377f",null)),N=I.exports,W={components:{AddAcounts:j,ConfirmModify:N},data:function(){return{formData:{account:"",accountList:[{account:""}],releaseDate:"",checked:!1,reason:""},dialogFormVisible:!1,formLabelWidth:"80px",title:"新增停權帳號",rules:{account:[{required:!0,message:"請輸入帳號",trigger:"change"}],days:[{required:!0,message:"請輸入停權天數",trigger:"change"},{pattern:/^[0-9]*$/,message:"請輸入數字",trigger:"change"}]}}},computed:{days:function(){return this.formData.days},checked:function(){return this.formData.checked}},watch:{days:function(t){t&&parseInt(t)?this.formData.releaseDate=h()().add(t,"day").endOf("day").format("yyyy-MM-DD HH:mm:ss"):this.formData.releaseDate=""}},methods:{handleClose:function(t){this.loading=!1,this.dialogFormVisible=!1,this.formData={releaseDate:"",accountList:[{id:""}],checked:!1}},handleOpen:function(t,e){this.dialogFormVisible=!0},createSuspension:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=new FormData;a.append("account",t.formData.account),t.formData.checked?(a.append("releaseState","1"),a.append("releaseDate","")):(a.append("releaseDate",h()(t.formData.releaseDate).valueOf()),a.append("releaseState","0")),a.append("reason",t.formData.reason),d(a).then((function(e){var n=e.data;n.success?(t.$emit("initdata"),t.$message.success(n.msg)):t.$message.warning(n.msg),n.content?t.confirmModify(a,n.content):t.handleClose()})).catch((function(t){console.log(t)}))}}))},initdataChild:function(){this.handleClose(),this.$emit("initdata")},removeAccount:function(t){var e=this.formData.account.indexOf(t);-1!==e&&this.formData.account.splice(e,1)},addAccounts:function(){this.$refs.addAcounts.handleOpen(),this.$refs.addAcounts.createInit()},confirmModify:function(t,e){this.$refs.confirmModify.handleOpen(t,e)},setInit:function(t){this.formData=t}}},E=W,P=(a("f874"),Object(g["a"])(E,$,O,!1,null,"0fd4f315",null)),q=P.exports,J={name:"AccountSuspension",components:{Dialog:q,List:v,HistoryList:x},data:function(){return{loading:!1,tabMapOptions:[{label:"停權名單",key:"banList"},{label:"停權名單",key:"history"}],activeName:"banList",tableData:[]}},computed:{},mounted:function(){this.initdata()},created:function(){this.tableData=this.initData},methods:{checkPermission:c["a"],add:function(){this.$refs.dialog.handleOpen()},initdata:function(){var t=this;this.loading=!0,u().then((function(e){var a=e.data;a.success?t.tableData=Object(i["a"])(a.content):(t.tableData=[],t.$message.warning(a.msg)),t.loading=!1})).catch((function(t){console.log(t)}))},filterData:function(t){if(t)return t.filter((function(t){return t.isbaned}))}}},U=J,B=Object(g["a"])(U,n,o,!1,null,null,null);e["default"]=B.exports},f874:function(t,e,a){"use strict";a("c3f1")}}]);