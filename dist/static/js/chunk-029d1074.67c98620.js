(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-029d1074"],{"1f9a":function(e,t,a){},"2fa3":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-container"},[a("div",{staticClass:"table-container"},[a("el-tag",[e._v("線上公告")]),e.checkPermission(["修改線上公告"])?a("el-button",{staticStyle:{float:"right"},attrs:{icon:"el-icon-plus",type:"primary",circle:""},on:{click:e.add}}):e._e(),a("el-tabs",{staticStyle:{"margin-top":"10px"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabMapOptions,(function(t){return a("el-tab-pane",{key:t.key,attrs:{label:t.label,name:t.key},on:{"tab-click":e.changeTab}},[a("Announcement",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"table-data":e.filterData(e.tableData)},on:{edit:e.edit,initdata:e.initdata}})],1)})),1)],1),a("Dialog",{ref:"dialog",on:{initdata:e.initdata}})],1)},o=[],l=(a("4de4"),a("d81d"),a("a9e3"),a("5530")),r=a("2909"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{attrs:{data:e.tableData,border:"","row-key":"id"}},[e.checkPermission(["修改線上公告"])?a("div",[a("el-table-column",{attrs:{prop:"\n      operating",label:"功能",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return e.edit("編輯",t.row)}}},[e._v("編輯")]),"未上架"===t.row.status?a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(a){return e.lanuch("on",t.row)}}},[e._v("立即上架")]):e._e(),"上架中"===t.row.status?a("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(a){return e.lanuch("off",t.row)}}},[e._v("立即下架")]):e._e(),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return e.remove(t.row.id)}}},[e._v("刪除")])]}}],null,!1,978572185)})],1):e._e(),a("el-table-column",{attrs:{prop:"id",label:"編號",width:"100",sortable:""}}),a("el-table-column",{attrs:{prop:"title",label:"標題",width:"150"}}),a("el-table-column",{attrs:{prop:"category",label:"類型",width:"100"}}),a("el-table-column",{attrs:{prop:"status",label:"狀態",width:"100"}}),a("el-table-column",{attrs:{prop:"onsaledate",label:"上架時間",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("moment")(t.row.onsaledate))+" ")]}}])}),a("el-table-column",{attrs:{prop:"nosaledate",label:"下架時間",width:"160"}}),a("el-table-column",{attrs:{prop:"creator",label:"建立者",width:"100"}}),a("el-table-column",{attrs:{prop:"content",label:"內容"}})],1),a("div",{staticClass:"table-pagination"},[a("el-pagination",{attrs:{"current-page":1,"page-sizes":[100,200,300,400],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},s=[],c=a("e350"),d=a("c1df"),u=a.n(d),m=a("b775");function f(){return Object(m["a"])({url:"operation_getbulletin",method:"get"})}function p(e){return Object(m["a"])({url:"operation_createbulletin",method:"post",data:e})}function h(e){return Object(m["a"])({url:"operation_updatebulletin",method:"post",data:e})}function g(e){return Object(m["a"])({url:"operation_deletebulletin",method:"post",data:e})}a("caad"),a("45fc"),a("ac1f"),a("2532"),a("1276");var b=a("4360");function D(e,t){var a=t.value,n=b["a"].getters&&b["a"].getters.roles;if(!(a&&a instanceof Array))throw new Error("need roles! Like v-permission=\"['admin','editor']\"");if(a.length>0){var o=n.split(","),l=a,r=o.some((function(e){return l.includes(e)}));r||e.parentNode&&e.parentNode.removeChild(e)}}var v={inserted:function(e,t){D(e,t)},update:function(e,t){D(e,t)}},y=function(e){e.directive("permission",v)};window.Vue&&(window["permission"]=v,Vue.use(y)),v.install=y;var w=v,k={name:"Announcement",directives:{permission:w},props:{tableData:{type:Array,default:function(){return[]}}},data:function(){return{}},methods:{checkPermission:c["a"],handleSizeChange:function(e){console.log("每页 ".concat(e," 条"))},handleCurrentChange:function(e){console.log("当前页: ".concat(e))},edit:function(e,t){this.$emit("edit",{title:e,row:t})},remove:function(e){var t=this,a=new FormData;a.append("id",e),g(a).then((function(e){var a=e.data;a.success?(t.$emit("initdata"),t.$message.success(a.msg)):t.$message.warning(a.msg)})).catch((function(e){console.log(e)}))},lanuch:function(e,t){var a=this,n=new FormData;n.append("title",t.title),n.append("category",t.category),"on"===e?(n.append("onsaledate",u()(Date.now()).format("yyyy-MM-DD HH:mm:ss")),n.append("nosaledate",t.nosaledate)):(n.append("onsaledate",t.onsaledate),n.append("nosaledate",u()(Date.now()).format("yyyy-MM-DD HH:mm:ss"))),n.append("content",t.content),n.append("id",t.id),h(n).then((function(e){var t=e.data;t.success?(a.$emit("initdata"),a.$message.success(t.msg)):a.$message.warning(t.msg)})).catch((function(e){console.log(e)}))}}},_=k,$=(a("9a69"),a("2877")),O=Object($["a"])(_,i,s,!1,null,"8e532296",null),C=O.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:e.title,"before-close":e.handleClose,visible:e.dialogFormVisible,width:"50%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.formData}},[a("el-form-item",{attrs:{prop:"title",label:"標題","label-width":e.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"請輸入標題"},model:{value:e.formData.title,callback:function(t){e.$set(e.formData,"title",t)},expression:"formData.title"}})],1),a("el-form-item",{attrs:{prop:"category",label:"分類","label-width":e.formLabelWidth}},[e.isSelect?[a("el-select",{attrs:{placeholder:"請選擇分類"},model:{value:e.formData.category,callback:function(t){e.$set(e.formData,"category",t)},expression:"formData.category"}},[a("el-option",{attrs:{label:"重要",value:"重要"}}),a("el-option",{attrs:{label:"活動",value:"活動"}}),a("el-option",{attrs:{label:"維護",value:"維護"}}),a("el-option",{attrs:{label:"補償",value:"補償"}}),a("el-option",{attrs:{label:"其他",value:"其他"}})],1)]:e._e(),e.isSelect?e._e():[a("el-input",{staticClass:"category-input",attrs:{placeholder:"請輸入類型名稱"},model:{value:e.formData.category,callback:function(t){e.$set(e.formData,"category",t)},expression:"formData.category"}})],a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"form"},on:{click:function(t){e.isSelect=!e.isSelect}}})],2),a("el-form-item",{attrs:{prop:"onsaledate",label:"日期","label-width":e.formLabelWidth}},[a("el-date-picker",{staticClass:"form-margin",attrs:{type:"datetime",placeholder:"請選擇上架日期時間","value-format":"yyyy-MM-dd HH:mm:ss",disabled:e.checked},model:{value:e.formData.onsaledate,callback:function(t){e.$set(e.formData,"onsaledate",t)},expression:"formData.onsaledate"}}),a("el-checkbox",{on:{change:e.doCheck},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v("立即上架")])],1),a("el-form-item",{attrs:{prop:"nosaledate","label-width":e.formLabelWidth}},[a("el-date-picker",{staticClass:"form-margin",attrs:{type:"datetime",placeholder:"請選擇下架日期時間","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":e.pickerOptions},model:{value:e.formData.nosaledate,callback:function(t){e.$set(e.formData,"nosaledate",t)},expression:"formData.nosaledate"}})],1),a("el-form-item",{attrs:{prop:"content",label:"內容","label-width":e.formLabelWidth}},[a("el-input",{attrs:{type:"textarea",rows:6,placeholder:"請輸入公告內容"},model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),"新增公告"===e.title?a("el-button",{attrs:{type:"primary"},on:{click:e.createBulletin}},[e._v("建 立")]):e._e(),"編輯公告"===e.title?a("el-button",{attrs:{type:"primary"},on:{click:e.updateBulletin}},[e._v("更 新")]):e._e()],1)],1)],1)},F=[],x=(a("b64b"),{components:{},data:function(){return{formData:{title:"",category:"",onsaledate:"",nosaledate:"",content:""},checked:!1,dialogFormVisible:!1,isOnSaleDateError:!1,isSelect:!0,formLabelWidth:"80px",title:"新增公告",rules:{title:[{required:!0,message:"請輸入標題",trigger:"change"}],category:[{required:!0,message:"請輸入類型名稱",trigger:"change"}],onsaledate:[{required:!0,trigger:"change",validator:this.handleOnSaleDate}],nosaledate:[{required:!0,trigger:"change",validator:this.handleNoSaleDate}],content:[{required:!0,message:"請輸入內容",trigger:"change"}]}}},computed:{pickerOptions:function(){var e=this;return{disabledDate:function(t){return!e.isOnSaleDateError&&u()(t)<u()(e.formData.onsaledate)}}}},methods:{resetFormData:function(){this.formData={title:"",category:"",onsaledate:"",nosaledate:"",content:""},this.isSelect=!0},handleClose:function(e){var t=this;this.loading=!1,this.dialogFormVisible=!1,this.checked=!1,this.resetFormData(),this.$nextTick((function(){t.$refs["ruleForm"].clearValidate(Object.keys(t.formData))}))},handleOpen:function(e,t){this.dialogFormVisible=!0,this.title=e+"公告","編輯"===e&&(this.formData=Object.assign({},t),this.formData.onsaledate=new Date(this.formData.onsaledate),this.formData.nosaledate=new Date(this.formData.nosaledate))},handleOnSaleDate:function(e,t,a){t&&u()(t)>u()(this.formData.nosaledate)?(this.isOnSaleDateError=!0,a(new Error("請選擇正確的上架日期"))):t?(this.isOnSaleDateError=!1,a()):a(new Error("上架日期不得為空"))},handleNoSaleDate:function(e,t,a){if(t&&u()(t)<u()(this.formData.onsaledate))return a(new Error("請選擇正確的下架日期"));t?(this.formData.onsaledate&&this.$refs["ruleForm"].validateField(["onsaledate"]),this.isOnSaleDateError=!1,a()):a(new Error("下架日期不得為空"))},createBulletin:function(){var e=this;this.$refs["ruleForm"].validate((function(t){if(t){var a=new FormData;a.append("title",e.formData.title),a.append("category",e.formData.category),a.append("onsaledate",e.getdatetime(e.formData.onsaledate)),a.append("nosaledate",e.getdatetime(e.formData.nosaledate)),a.append("content",e.formData.content),p(a).then((function(t){e.$emit("initdata"),e.handleClose()})).catch((function(e){console.log(e)}))}}))},updateBulletin:function(){var e=this;this.$refs["ruleForm"].validate((function(t){if(t){var a=new FormData;a.append("title",e.formData.title),a.append("category",e.formData.category),a.append("onsaledate",e.getdatetime(e.formData.onsaledate)),a.append("nosaledate",e.getdatetime(e.formData.nosaledate)),a.append("content",e.formData.content),a.append("id",e.formData.id),h(a).then((function(t){var a=t.data;a.success?(e.$emit("initdata"),e.$message.success(a.msg)):e.$message.warning(a.msg),e.dialogFormVisible=!1})).catch((function(e){console.log(e)}))}}))},open:function(e){this.$message({message:e,type:"warning"})},getdatetime:function(e){return u()(e).format("YYYY-MM-DD HH:mm:ss")},doCheck:function(e){e?this.$set(this.formData,"onsaledate",u()().format("YYYY-MM-DD HH:mm:ss")):this.$set(this.formData,"onsaledate","")}}}),M=x,j=(a("63a9"),Object($["a"])(M,S,F,!1,null,"8a606a90",null)),E=j.exports,H={name:"OnlineAnnouncement",components:{Dialog:E,Announcement:C},data:function(){return{loading:!1,tabMapOptions:[{label:"公告欄",key:"all"},{label:"上架中",key:"launched"},{label:"未上架",key:"notLaunch"},{label:"已下架",key:"removed"}],activeName:"all",tableData:[]}},mounted:function(){this.initdata()},methods:{checkPermission:c["a"],add:function(){this.$refs.dialog.handleOpen("新增")},edit:function(e){var t=e.title,a=e.row;this.$refs.dialog.handleOpen(t,a)},filterData:function(){switch(this.activeName){case"launched":return this.tableData.filter((function(e,t,a){return"上架中"===e.status}));case"notLaunch":return this.tableData.filter((function(e,t,a){return"未上架"===e.status}));case"removed":return this.tableData.filter((function(e,t,a){return"已下架"===e.status}));case"all":return this.tableData}},initdata:function(){var e=this;this.loading=!0;var t="";switch(this.activeName){case"launched":t="0";break;case"notLaunch":t="1";break;case"removed":t="2";break}var a=new FormData;a.append("state",t),f(a).then((function(t){var a=t.data;a.success?(e.tableData=Object(r["a"])(a.content.data),e.tableData=e.tableData.map((function(e){return Object(l["a"])(Object(l["a"])({},e),{},{id:Number(e.id)})}))):(e.tableData=[],e.$message.warning(a.msg)),e.loading=!1})).catch((function(e){console.log(e)}))},changeTab:function(e,t){alert()}}},N=H,L=Object($["a"])(N,n,o,!1,null,null,null);t["default"]=L.exports},"63a9":function(e,t,a){"use strict";a("93e8")},"93e8":function(e,t,a){},"9a69":function(e,t,a){"use strict";a("1f9a")},e350:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("caad"),a("45fc"),a("ac1f"),a("2532"),a("1276");var n=a("4360");function o(e){if(e&&e instanceof Array&&e.length>0){var t=n["a"].getters&&n["a"].getters.roles,a=t.split(","),o=e,l=a.some((function(e){return o.includes(e)}));return l}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}}}]);